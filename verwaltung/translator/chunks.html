<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>chunk translation tool</title>
		<script src="resources/ajax.js"></script>
		<script>
		var saved=true;
		(function(){
			getJSON("back.php?chunks",(data)=>{
				data.forEach((el)=>{
					var li = document.createElement('li');
					li.innerHTML = el;
					li.onclick = (evt) => {
						if(!saved){
							if(!confirm("really switch without saving?")){
								return;
							}
						}
						var elems=document.querySelectorAll(".selected");
						for (elem of elems) {
							elem.classList.remove('selected');
						}
						evt.target.classList.add('selected');
						getText("back.php?chunk="+evt.target.innerHTML,(data)=>{
							document.getElementById('text').value=data;
							saved=true;
						});
					};
					document.getElementById("chunk-list").appendChild(li);
				});
			});
		})();
		function save(){
			var data = {
				type:"chunk",
				name:document.getElementsByClassName('selected')[0].innerHTML,
				text:document.getElementById('text').value
			};
			postJSON("back.php",data,()=>{saved=true;});
		}
		</script>
		<style>
			*{
				margin: 0;
				padding: 0;
			}
			html,body{
				height:100%;
			}
			#chunk-list{
				border-right: 1px solid black;
				float:left;
				box-sizing: border-box;
				width:10%;
				height:100%;
				padding: 10px;
				list-style: none;
			}
			#chunk-list li.selected{
				background-color: gray;
			}
			#text{
				float:right;
				box-sizing: border-box;
				width:90%;
				height:90%;
				padding: 5px;
				resize: none;
				overflow: scroll;
			}
			#save{
				box-sizing: border-box;
				outline:none;
				border:none;
				border-top:1px solid black;
				background:gray;
				width:90%;
				height:10%;
			}
		</style>
	</head>
	<body>
		<ul id="chunk-list"></ul>
		<textarea contenteditable="true" id="text" oninput="saved=false;"></textarea>
		<button type="button" onclick="save()" id="save">save</button>
	</body>
</html>
